<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.0">
<link rel="alternate" type="application/rss+xml" href="/news/rss.xml" title="Singularity Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/news/atom.xml" title="Singularity Blog Atom Feed">
<link rel="search" type="application/opensearchdescription+xml" title="Singularity" href="/opensearch.xml"><title data-react-helmet="true">Container Security | Singularity</title><meta data-react-helmet="true" property="og:url" content="https://singularity.hpcng.org/docs-admin/security"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-docs-admin-current"><meta data-react-helmet="true" property="og:title" content="Container Security | Singularity"><meta data-react-helmet="true" name="description" content="Containers are all the rage today for many good reasons. They are light weight, easy to spin-up and require reduced IT management resources as compared to hardware VM environments. More importantly, container technology facilitates advanced research computing by granting the ability to package software in highly portable and reproducible environments encapsulating all dependencies, including the operating system. But there are still some challenges to container security."><meta data-react-helmet="true" property="og:description" content="Containers are all the rage today for many good reasons. They are light weight, easy to spin-up and require reduced IT management resources as compared to hardware VM environments. More importantly, container technology facilitates advanced research computing by granting the ability to package software in highly portable and reproducible environments encapsulating all dependencies, including the operating system. But there are still some challenges to container security."><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.png"><link data-react-helmet="true" rel="canonical" href="https://singularity.hpcng.org/docs-admin/security"><link data-react-helmet="true" rel="alternate" href="https://singularity.hpcng.org/docs-admin/security" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://singularity.hpcng.org/docs-admin/security" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.df3ffb68.css">
<link rel="preload" href="/assets/js/runtime~main.a843a528.js" as="script">
<link rel="preload" href="/assets/js/main.d90a00b9.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/logo.png" alt="Singularity Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo.png" alt="Singularity Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">Singularity</strong></a><a class="navbar__item navbar__link" href="/docs-user/">User Documentation</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs-admin/">Administrator Documentation</a><a class="navbar__item navbar__link" href="/news">News</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/hpcng/singularity" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle displayOnlyInLargeViewport_GrZ2 react-toggle--disabled" role="button" tabindex="-1"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/logo.png" alt="Singularity Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo.png" alt="Singularity Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">Singularity</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs-user/">User Documentation</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/docs-admin/">Administrator Documentation</a></li><li class="menu__list-item"><a class="menu__link" href="/news">News</a></li><li class="menu__list-item"><a href="https://github.com/hpcng/singularity" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><div class="docSidebarContainer_3Kbt" role="complementary"><div class="sidebar_15mo"><div class="menu menu--responsive thin-scrollbar menu_Bmed"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_fgN0" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs-admin/">Admin Quick Start</a></li><li class="menu__list-item"><a class="menu__link" href="/docs-admin/installation">Installing Singularity</a></li><li class="menu__list-item"><a class="menu__link" href="/docs-admin/configfiles">Configuration Files</a></li><li class="menu__list-item"><a class="menu__link" href="/docs-admin/user_namespace">User Namespaces &amp; Fakeroot</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" href="/docs-admin/security">Container Security</a></li><li class="menu__list-item"><a class="menu__link" href="/docs-admin/appendix">Appendix</a></li></ul></div></div></div><main class="docMainContainer_3ufF"><div class="container padding-vert--lg docItemWrapper_3FMP"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><header><h1 class="docTitle_3a4h">Container Security</h1></header><div class="markdown"><p>Containers are all the rage today for many good reasons. They are light weight, easy to spin-up and require reduced IT management resources as compared to hardware VM environments. More importantly, container technology facilitates advanced research computing by granting the ability to package software in highly portable and reproducible environments encapsulating all dependencies, including the operating system. But there are still some challenges to container security. </p><p>Singularity, which is a container paradigm created by necessity for scientific and application driven workloads, addresses some
core missions of containers : Mobility of Compute, Reproducibility, HPC support, and <strong>Security</strong>. This document intends to inform
admins of different security features supported by Singularity.</p><p>Singularity Runtime
###################</p><p>The Singularity runtime enforces a unique security model that makes it appropriate for <em>untrusted users</em> to run <em>untrusted containers</em>
safely on multi-tenant resources. Because the Singularity runtime dynamically writes UID and GID information to the appropriate files
within the container, the user remains the same <em>inside</em> and <em>outside</em> the container, i.e., if you&#x27;re an unprivileged
user while entering the container, you&#x27;ll remain an unprivileged user inside the container. A privilege separation model is in place
to prevent users from escalating privileges once they are inside of a container. The container file system is mounted using the
<code>nosuid</code> option, and processes are spawned with the <code>PR_NO_NEW_PRIVS</code> flag. Taken together, this approach provides a secure way
for users to run containers and greatly simplifies things like reading and writing data to the host system with appropriate
ownership.</p><p>It is also important to note that the philosophy of Singularity is <em>Integration</em> over <em>Isolation</em>. Most container run times strive
to isolate your container from the host system and other containers as much as possible. Singularity, on the
other hand, assumes that the userâ€™s primary goals are portability, reproducibility, and ease of use and that isolation is often a
tertiary concern. Therefore, Singularity only isolates the mount namespace by default, and will also bind mount several host
directories such as <code>$HOME</code> and <code>/tmp</code> into the container at runtime. If needed, additional levels of isolation can be achieved
by passing options causing Singularity to enter any or all of the other kernel namespaces and to prevent automatic bind mounting.
These measures allow users to interact with the host system from within the container in sensible ways.</p><p>Singularity Image Format (SIF)
##############################</p><p>Sylabs addresses container security as a continuous process. It attempts to provide container integrity throughout the distribution
pipeline.. i.e., at rest, in transit and while running. Hence, the SIF has been designed to achieve these goals. </p><p>A SIF file is an immutable container runtime image. It is a physical representation of the container environment itself. An
important component of SIF that elicits security feature is the ability to cryptographically sign a container, creating a signature
block within the SIF file which can guarantee immutability and provide accountability as to who signed it. Singularity follows the
<code>OpenPGP &lt;https://www.openpgp.org/&gt;</code>_ standard to create and manage these keys. After building an image within Singularity, users can
<code>singularity sign</code> the container and push it to the Library along with its public PGP key(Stored in :ref:<code>Keystore &lt;keystore&gt;</code>) which
later can be verified (<code>singularity verify</code>) while pulling or downloading the image. This feature in particular
protects collaboration within and between systems and teams. </p><p>SIF Encryption</p><hr><p>In Singularity 3.4 and above the container root filesystem that
resides in the squashFS partition of a SIF can be encrypted, rendering
it&#x27;s contents inaccessible without a secret. Unlike other platforms,
where encrypted layers must be assembled into an unencrypted runtime
directory on disk, Singularity mounts the encrypted root file system
directly from the SIF using Kernel dm-crypt/LUKS functionality, so
that the content is not exposed on disk. Singularity containers
provide a comparable level of security to LUKS2 full disk encryption
commonly deployed on Linux server and desktop systems.</p><p>As with all matters of security, a layered approach must be taken and
the system as a whole considered. For example, it is possible that
decrypted memory pages could be paged out the system swap file or
device, which could result in decrypted information being stored at
rest on physical media. Operating system level mitigations such as
encrypted swap space may be required depending on the needs of your
application.</p><p>Encryption and decryption of containers requires <code>cryptsetup</code>
version 2. The SIF root filesystem will be encrypted using the
default LUKS cipher on the host. The current default cipher used by
<code>cryptsetup</code> for LUKS2 in mainstream Linux distributions is
<code>aes-xts-plain64</code> with a 256 bit key size. The default key
derivation function for LUKS2 is <code>argon2i</code>.</p><p>Singularity currently supports 2 types of secrets for encrypted
containers:</p><ul><li><em>Passphrase</em>: a text passphrase is passed directly to
<code>cryptsetup</code> for LUKS encryption of the root fs.</li><li><em>Asymmetric RSA keypair</em>: a randomly generated 256-bit secret is
used to perform LUKS encryption of the rootfs.  This secret is
encrypted with a user-provided RSA public key, and the ciphertext
stored in the SIF file. At runtime the RSA private key must be
provided to decrypt the secret and allow decryption of the root
filesystem to use the container.</li></ul><p>.. note::</p><p>   You can verify the default LUKS2 cipher and PBKDF on your system by
running <code>cryptsetup --help</code>.</p><p>   <code>cryptsetup</code> sets a memory cost for the <code>argon2i</code> PBKDF based on
the RAM available in the system used for encryption, up to a
maximum of 1GiB. Encrypted containers created on systems with &gt;2GiB
RAM may be unusable on systems with &lt;1GiB of free RAM.</p><p>Admin Configurable Files
#########################</p><p>Singularity Administrators have the ability to access various configuration files, that will let them set security
restrictions, grant or revoke a userâ€™s capabilities, manage resources and authorize containers etc. One such file interesting in this context is <code>ecl.toml &lt;https://sylabs.io/guides/\{adminversion\}/admin-guide/configfiles.html#ecl-toml&gt;</code>_
which allows blacklisting and whitelisting of containers. You can find all the configuration files and their parameters
documented <code>here &lt;https://sylabs.io/guides/\{adminversion\}/admin-guide/configfiles.html&gt;</code>__. </p><p>cgroups support</p><hr><p>Starting v3.0, Singularity added native support for <code>cgroups</code>, allowing users to limit the resources their containers consume
without the help of a separate program like a batch scheduling system. This feature helps in preventing  DoS attacks where one
container seizes control of all available system resources in order to stop other containers from operating properly.
To utilize this feature, a user first creates a configuration file. An example configuration file is installed by default with
Singularity to provide a guide. At runtime, the <code>--apply-cgroups</code> option is used to specify the location of the configuration
file and cgroups are configured accordingly. More about cgroups support <code>here &lt;https://sylabs.io/guides/\{adminversion\}/admin-guide/configfiles.html#cgroups-toml&gt;</code>__.</p><p><code>--security</code> options</p><hr><p>Singularity supports a number of methods for specifying the security scope and context when running Singularity containers.
Additionally, it supports new flags that can be passed to the action commands; <code>shell</code>, <code>exec</code>, and <code>run</code> allowing fine
grained control of security. Details about them are documented <code>here &lt;https://sylabs.io/guides/\{userversion\}/user-guide/security_options.html&gt;</code>__.</p><p>Security in SCS
################</p><p><code>Singularity Container Services (SCS) &lt;https://cloud.sylabs.io/home&gt;</code>_ consist of a Remote Builder, a Container Library, and a
Keystore. Taken together, the Singularity Container Services provide an end-to-end solution for packaging and distributing
applications in secure and trusted containers.</p><p>Remote Builder</p><hr><p>As mentioned earlier, the Singularity runtime prevents executing code with root-level permissions on the host system. But building a
container requires elevated privileges that most production environments do not grant to users. <code>The Remote Builder &lt;https://cloud.sylabs.io/builder&gt;</code>_
solves this challenge by allowing unprivileged users a service that can be used to build containers targeting one or more CPU
architectures. System administrators can use the system to monitor which users are building containers, and the contents of those
containers. Starting with Singularity 3.0, the CLI has native integration with the Build Service from version 3.0 onwards. In
addition, a web GUI interface to the Build Service also exists, which allows users to build containers using only a web browser.</p><p>.. note::</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Please see the :ref:`Fakeroot feature &lt;fakeroot&gt;` which is a secure option for admins in multi-tenant HPC environments and </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">similar use cases where they might want to grant a user special privileges inside a container.</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Container Library</p><hr><p>The <code>Container Library &lt;https://cloud.sylabs.io/library&gt;</code>_ enables users to store and share Singularity container images based on
the Singularity Image Format (SIF). A web front-end allows users to create new projects within the Container Library, edit
documentation associated with container images, and discover container images published by their peers.</p><p>.. _keystore:</p><p>Key Store</p><hr><p>The <code>Key Store &lt;https://cloud.sylabs.io/keystore&gt;</code><em> is a key management system offered by Sylabs that utilizes <code>OpenPGP implementation &lt;https://gnupg.org/&gt;</code></em> to facilitate sharing and maintaining of PGP public keys used to sign and verify Singularity container images. This service is based on the OpenPGP HTTP Keyserver Protocol (HKP), with several enhancements:</p><ul><li>The Service requires connections to be secured with Transport Layer Security (TLS).</li><li>The Service implements token-based authentication, allowing only authenticated users to add or modify PGP keys.</li><li>A web front-end allows users to view and search for PGP keys using a web browser.</li></ul><p>Security Considerations of Cloud Services:</p><hr><ol><li><p>Communications between users, the auth service and the above-mentioned services are secured via TLS.</p></li><li><p>The services support authentication of users via authentication tokens.</p></li><li><p>There is no implicit trust relationship between Auth and each of these services. Rather, each request between the services is authenticated using the authentication token supplied by the user in the associated request.</p></li><li><p>The services support MongoDB authentication as well as TLS/SSL. </p></li></ol><p>.. note::</p><p>   SingularityPRO is a professionally curated and licensed version of Singularity that provides added security, stability, and
support beyond that offered by the open source project. Subscribers receive advanced access to security patches through regular
updates so, when a CVE is announced publicly PRO subscribers are already using patched software.</p><p>Security is not a check box that one can tick and forget.  Itâ€™s an ongoing process that begins with software architecture, and
continues all the way through to ongoing security practices.  In addition to ensuring that containers are run without elevated
privileges where appropriate, and that containers are produced by trusted sources, users must monitor their containers for newly
discovered vulnerabilities and update when necessary just as they would with any other software. Sylabs is constantly probing to
find and patch vulnerabilities within Singularity, and will continue to do so.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/hpcng/singularity-web/edit/main/docs-admin/security.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-label="Edit page"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs-admin/user_namespace"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« User Namespaces &amp; Fakeroot</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs-admin/appendix"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Appendix Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs-user">Getting Started</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://join.slack.com/t/hpcng/shared_invite/zt-ll5c3ofb-XhvMPbXUhTVrHlutQz2jbA" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack</a></li><li class="footer__item"><a href="https://groups.google.com/a/lbl.gov/g/singularity" target="_blank" rel="noopener noreferrer" class="footer__link-item">Mailing List</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/news">News</a></li><li class="footer__item"><a href="https://github.com/hpcng/singularity" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 HPCng. - All Rights Reserved.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.a843a528.js"></script>
<script src="/assets/js/main.d90a00b9.js"></script>
</body>
</html>